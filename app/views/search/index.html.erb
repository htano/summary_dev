<% content_for :head do %>
<%= stylesheet_link_tag "search", "bootstrap/bootstrap.css"  %>
<% end %>

<script>
$(document).ready(function() {
  set_option_area()
  hide_navbar_text()
});
</script>

<form id="search_form" action="search" onLoad="set_option_area">
  <div id="search_main">
    <div id="operation_area">
      <div id="operation">
        <input type="text" name="searchtext" id="searchtext" value="<%= @searchtext %>" placeholder="Please input the words you want.">
        <input type="submit" id="search" value="search" class="button button-flat:hover submit"><br>
      </div>
    </div>
    <div id="option_area">
<!--
      <div class="type">
        <p>type</p>
        <div class="select_area">
          <span id="type_article">article</span><br>
          <span id="type_user">user</span><br>
          <input type="hidden" name="type" id="type" value="<%= @type %>">
        </div>
      </div>
-->
      <div class="target">
        <p>target</p>
        <div class="select_area">
          <span id="target_content">content</span><br>
          <span id="target_tag">tag</span><br>
          <span id="target_domain">domain</span><br>
          <input type="hidden" name="target" id="target" value="<%= @target %>">
        </div>
      </div>
    </div>
    <div id="result_area">
      <% if @articles == nil || @articles.length == 0 %>
      　　<%= @searchtext %> の <%= @target_text %> 検索結果 <%= @articles_num %> 件
      <% else %>
        <div id="article_operation">
          <span id="message">
            <%= @searchtext %> の <%= @target_text %> 検索結果 <%= @articles_num %> 件
          </span>
          <% if get_login_user %>
            <span>
                <input type="checkbox" id="not_read_only"> Not Read only.
            </span>
          <% end %>
          <span id="sort">
            <div class="btn-group sort-split-btn">
              <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
              <%= @sort_menu_title %><span class="caret"></span>
              </button>
                <ul class="dropdown-menu">
                  <li><%= link_to "Newest" ,{:controller => "search", :action => "search", :searchtext => @searchtext, :target => @target, :sort => "1"} %></li>
                  <li><%= link_to "Summary num" ,{:controller => "search", :action => "search", :searchtext => @searchtext, :target => @target, :sort => "2"} %></li>
                  <li><%= link_to "Reader num" ,{:controller => "search", :action => "search", :searchtext => @searchtext, :target => @target, :sort => "3"} %></li>
                </ul>
            </div>
<!--
            <div class="btn-group">
              <button class="btn dropdown-toggle" data-toggle="dropdown">sort <span class="caret"></span></button>
                <ul class="dropdown-menu">
                  <li><%= link_to "Newest" ,{:controller => "search", :action => "search", :searchtext => @searchtext, :target => @target, :sort => "1"} %></li>
                  <li><%= link_to "Summary num" ,{:controller => "search", :action => "search", :searchtext => @searchtext, :target => @target, :sort => "2"} %></li>
                  <li><%= link_to "Reader num" ,{:controller => "search", :action => "search", :searchtext => @searchtext, :target => @target, :sort => "3"} %></li>
                </ul>
            </div>          
-->
          </span>
        </div>
        <% @articles.each do |article| %>
          <% if get_login_user && article.user_articles.where(:user_id => get_login_user.id).first %>
            <div class="article_contents">
          <% else %>
            <div class="article_contents_not_read">
          <% end %>
              <div id="url_title">
                <p><a href="<%= article.url %>" target="_blank"><%= article.title[0, 200] %></a></p>
              </div>
              <div id="article_infomation">
                <div id="summary_num">
                  <% if article.summaries_count == 1 %>
                    <%= link_to article.summaries.length , {:controller => "summary_lists", :action => "index", :article_id => article.id} %>summary
                  <% else %>
                    <%= link_to article.summaries.length , {:controller => "summary_lists", :action => "index", :article_id => article.id} %>summaries
                  <% end %>
                </div>
                <div id="user_article_num">
                  <% if article.user_articles.length == 1 %>
                    <p><%= article.user_articles.length %> reader</p>
                  <% else %>
                    <p><%= article.user_articles.length %> readers</p>
                  <% end %>
                </div>
              </div>
              <div id="thumbnail">
                <%= image_tag(article.thumbnail) %>
              </div>
              <div id="contents_preview">
                <p><%= article.contents_preview[0, 200] %></p>
              </div>

              <div id="url_host">
                <!--<p><%= image_tag "http://favicon.hatena.ne.jp/?url=" + article.url %><a href="<%= URI(article.url).host %>" target="_blank"><%= URI(article.url).host %></a></p>-->
                <p><%= image_tag "http://favicon.hatena.ne.jp/?url=" + article.url %><%= link_to URI(article.url).host , {:controller => "search", :action => "search", :searchtext => URI(article.url).host, :target => "3", :sort => "1"} %></p>
              </div>

              <div id="article_operation">
                <% if get_login_user %>
                    <% if article.user_articles.where(:user_id => get_login_user.id).first %>
                      <button class="read_it_cancel" disabled>reading</button>
                    <% else %>
                      <button class="read_it_later" >add</button>
                    <% end %>
                <% else %>
                <% end %>
              </div>
              <% tags = article.get_top_rated_tag %>
              <% if tags == nil || tags.length == 0 %>
                <div id="tag">no tags for this article.<br></div>    
              <% else %>
                <div id="tag">
                  <% tags.each do |tag| %>
                    <!--<span class="edited_tag"><%= link_to tag ,{:controller => "search", :action => "search", :searchtext => tag} %></span>-->
                    <span class="edited_tag"><%= link_to tag ,{:controller => "search", :action => "search", :searchtext => tag, :target => "2", :sort => "1"} %></span>
                  <% end %>
                </div>
              <% end %>
              <div id="category">
                category
              </div>
            </div>
          <% end %>
        <div style='text-align:center;'>
          <%= paginate @articles, :window => 4, :outer_window => 2  %>
        </div>        
      <% end %>
    </div>
  </div>
</form>
