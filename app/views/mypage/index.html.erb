<%= content_for :head do %>
  <%= stylesheet_link_tag "mypage" %>
<% end %>

<script type="text/javascript">
  toggleUnfollowBtn();
</script>
<% if @is_login_user %>
<script type="text/javascript">
  $(window).on('beforeunload', function() {
    setTabInfoBeforeUnload();
  });
  $(window).on('load', function() {
    delCookie('other_tab');
    delCookie('name');

    var lastStayedTab = getCookie('tab', 'main');
    checkAll(lastStayedTab, false);
    activateTab(lastStayedTab);
    makeSortLink(lastStayedTab);
  });
</script>
<% else %>
<script type="text/javascript">
  $(window).on('beforeunload', function() {
    setTabInfoBeforeUnload('<%= @user.name %>');
  });
  $(window).on('load', function() {
    delCookie('tab');

    var userNameCookie = getCookie('name', null);
    var lastStayedTab = 'main';
    if (userNameCookie == '<%= @user.name %>') {
      lastStayedTab = getCookie('other_tab', 'main');
    } 
    checkAll(lastStayedTab, false);
    activateTab(lastStayedTab);
    makeSortLink(lastStayedTab);
  });
</script>
<% end %>


<div class="container">
  <div class="myrow">
    <%= render_profile() %>
    <div class="span9">
      <div class="div-tag">
        <ul class="tab clear">
          <li class="main my-overflow" onclick="setCurrentTab('main')">
            <a href=".main" data-toggle="tab"><%= t('tab.main') %></a>
          </li>
          <li class="summary my-overflow" onclick="setCurrentTab('summary')">
            <a href=".summary" data-toggle="tab"><%= t('tab.summary') %></a>
          </li>
          <li class="favorite my-overflow" onclick="setCurrentTab('favorite')">
            <a href=".favorite" data-toggle="tab"><%= t('tab.favorite') %></a>
          </li>
          <li class="read my-overflow" onclick="setCurrentTab('read')">
            <a href=".read" data-toggle="tab"><%= t('tab.read') %></a>
          </li>
        </ul>
        <div class="btn-group sort-split-btn">
          <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown">
            <%= raw get_sort_title(@sort_menu_title) %>
          <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li class="sort-type">
              <a href="/mypage/index?name=<%= @user.name %>&mpage=1&direction=desc&sort=registered">
                <%= raw is_selected_sort_type(@sort_menu_title, "Newest", "desc-registered") %>
              </a>
            </li>
            <li class="sort-type">
              <a href="/mypage/index?name=<%= @user.name %>&mpage=1&direction=asc&sort=registered">
                <%= raw is_selected_sort_type(@sort_menu_title, "Oldest", "asc-registered") %>
              </a>
            </li>
            <li class="sort-type">
              <a href="/mypage/index?name=<%= @user.name %>&mpage=1&direction=desc&sort=summaries">
                <%= raw is_selected_sort_type(@sort_menu_title, "Most summarized", "asc-registered") %>
              </a>
            </li>
            <li class="sort-type">
              <a href="/mypage/index?name=<%= @user.name %>&mpage=1&direction=asc&sort=summaries">
                <%= raw is_selected_sort_type(@sort_menu_title, "Least summarized", "asc-registered") %>
              </a>
            </li>
            <li class="sort-type">
              <a href="/mypage/index?name=<%= @user.name %>&mpage=1&direction=desc&sort=reader">
                <%= raw is_selected_sort_type(@sort_menu_title, "Most read", "asc-registered") %>
              </a>
            </li>
            <li class="sort-type">
              <a href="/mypage/index?name=<%= @user.name %>&mpage=1&direction=asc&sort=reader">
                <%= raw is_selected_sort_type(@sort_menu_title, "Least read", "asc-registered") %>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div id="article-controller">
        <% if @is_login_user %>
        <div class="none main">
          <div id="mark-as-read-btn">
            <%= link_to image_tag("icons/glyphicons_152_check_gray.png", :size => "16x16") +
              content_tag(:p, t('read_status.mark_as_read')),
              {:action => "mark_as_read"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div id="mark-as-favorite-btn">
            <%= link_to image_tag("icons/glyphicons_049_star_gray.png", :size => "16x16") +
              content_tag(:p, t('favorite_status.mark_as_favorite')),
              {:action => "mark_as_favorite"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div id="delete-btn">
            <%= link_to image_tag("icons/glyphicons_016_bin_gray.png", :size => "16x16") +
              content_tag(:p, t('article.delete')),
              {:action => "delete_article"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@mpage, @main_articles_table, :mpage, @total_main_articles_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@mpage, @main_articles_table, @total_main_articles_num) %>
          </p>
        </div>
        <div class="none summary">
          <div id="delete-summary-btn">
            <%= link_to image_tag("icons/glyphicons_016_bin_gray.png", :size => "16x16") +
              content_tag(:p, t('summary.delete')),
              {:action => "delete_summary"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@spage, @summaries_table, :spage, @total_summaries_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@spage, @summaries_table, @total_summaries_num) %>
          </p>
        </div>
        <div class="none favorite">
          <div id="mark-off-favorite-btn">
            <%= link_to image_tag("icons/glyphicons_049_star_gray.png", :size => "16x16") +
              content_tag(:p, t('favorite_status.mark_off_favorite')),
              {:action => "mark_off_favorite"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div id="delete-btn">
            <%= link_to image_tag("icons/glyphicons_016_bin_gray.png", :size => "16x16") +
              content_tag(:p, t('article.delete')),
              {:action => "delete_article"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@fpage, @favorite_articles_table, :fpage, @total_favorite_articles_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@fpage, @favorite_articles_table, @total_favorite_articles_num) %>
          </p>
        </div>
        <div class="none read">
          <div id="mark-as-unread-btn">
            <%= link_to image_tag("icons/glyphicons_152_check_gray.png", :size => "16x16") +
              content_tag(:p, t('read_status.mark_as_unread')),
              {:action => "mark_as_unread"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div id="mark-as-favorite-btn">
            <%= link_to image_tag("icons/glyphicons_049_star_gray.png", :size => "16x16") +
              content_tag(:p, t('favorite_status.mark_as_favorite')),
              {:action => "mark_as_favorite"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div id="delete-btn">
            <%= link_to image_tag("icons/glyphicons_016_bin_gray.png", :size => "16x16") +
              content_tag(:p, t('article.delete')),
              {:action => "delete_article"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@rpage, @read_articles_table, :rpage, @total_read_articles_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@rpage, @read_articles_table, @total_read_articles_num) %>
          </p>
        </div>
        <% else  # is_login_user %>
        <% if @user.public_flg %>
        <div class="none main">
          <div id="clip-btn">
            <%= link_to image_tag("icons/glyphicons_062_paperclip_gray.png", :size => "16x16") +
              content_tag(:p, t('clip.clip')),
              {:action => "clip"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@mpage, @main_articles_table, :mpage, @total_main_articles_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@mpage, @main_articles_table, @total_main_articles_num) %>
          </p>
        </div>
        <div class="none summary">
          <div id="clip-btn">
            <%= link_to image_tag("icons/glyphicons_062_paperclip_gray.png", :size => "16x16") +
              content_tag(:p, t('clip.clip')),
              {:action => "clip"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@spage, @summaries_table, :spage, @total_summaries_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@spage, @summaries_table, @total_summaries_num) %>
          </p>
        </div>
        <div class="none favorite">
          <div id="clip-btn">
            <%= link_to image_tag("icons/glyphicons_062_paperclip_gray.png", :size => "16x16") +
              content_tag(:p, t('clip.clip')),
              {:action => "clip"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@fpage, @favorite_articles_table, :fpage, @total_favorite_articles_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@fpage, @favorite_articles_table, @total_favorite_articles_num) %>
          </p>
        </div>
        <div class="none read">
          <div id="clip-btn">
            <%= link_to image_tag("icons/glyphicons_062_paperclip_gray.png", :size => "16x16") +
              content_tag(:p, t('clip.clip')),
              {:action => "clip"}, {:class => "btn btn-default btn-xs disabled", :method => :post} %>
          </div>
          <div class="page-ejection" style="float: right; padding: 0;">
            <%= render_page_ejection(@rpage, @read_articles_table, :rpage, @total_read_articles_num) %>
          </div>
          <p class="page_info">
            <%= raw get_page_position(@rpage, @read_articles_table, @total_read_articles_num) %>
          </p>
        </div>
        <% end # @user.public_flg %>
        <% end # is_login_user %>
      </div>
      <% if @is_login_user || @user.public_flg %>
      <div class="article-table">
        <form id="main-check-form" name="main_checkbox" class="main">
          <%= image_tag("loader.gif", :alt => "Ajax Loader", :width => "64", :height => "64", :class => "mypage-loader", :id => "main-table-loader") %>
          <table class="main-table">
            <tr class="table-top">
              <th id="article-title-top">
                <div class="article-checkbox">
                  <%= check_box 'check_all', 0, 
                  {:id => "main-check-all", :onclick => "checkAll('main')"}, 0, false %>
                </div>
                <%= t('article_table.title') %>
              </th>
              <th id="summary-number-top">
                <%= t('article_table.summary')%>
              </th>
            </tr>
            <%= render_article_table('main', @main_articles_table, 'mpage=' + @mpage.to_s) %>
          </table>
        </form>
        <form id="summary-check-form" name="summary_checkbox" class="summary">
          <%= image_tag("loader.gif", :alt => "Ajax Loader", :width => "64", :height => "64", :class => "mypage-loader", :id => "summary-table-loader") %>
          <table class="summary-table summary">
            <tr class="table-top">
              <th id="article-title-top">
                <div class="article-checkbox">
                  <%= check_box 'check_all', 0, 
                  {:id => "summary-check-all", :onclick => "checkAll('summary')"}, 0, false %>
                </div>
                <%= t('article_table.title') %>
              </th>
              <th id="summary-number-top">
                <%= t('article_table.summary')%>
              </th>
            </tr>
            <%= render_summary_table = render_summary_table('summary', @summaries_table, 'spage=' + @spage.to_s) %>
          </table>
        </form>
        <form id="favorite-check-form" name="favorite_checkbox" class="favorite">
          <%= image_tag("loader.gif", :alt => "Ajax Loader", :width => "64", :height => "64", :class => "mypage-loader", :id => "favorite-table-loader") %>
          <table class="favorite-table favorite">
            <tr class="table-top">
              <th id="article-title-top">
                <div class="article-checkbox">
                  <%= check_box 'check_all', 0, 
                  {:id => "favorite-check-all", :onclick => "checkAll('favorite')"}, 0, false %>
                </div>
                <%= t('article_table.title') %>
              </th>
              <th id="summary-number-top">
                <%= t('article_table.summary')%>
              </th>
            </tr>
            <%= render_favorite_table = render_article_table('favorite', @favorite_articles_table, 'fpage=' + @fpage.to_s) %>
          </table>
        </form>
        <form id="read-check-form" name="read_checkbox" class="read">
          <%= image_tag("loader.gif", :alt => "Ajax Loader", :width => "64", :height => "64", :class => "mypage-loader", :id => "read-table-loader") %>
          <table class="read-table read">
            <tr class="table-top">
              <th id="article-title-top">
                <div class="article-checkbox">
                  <%= check_box 'check_all', 0, 
                  {:id => "read-check-all", :onclick => "checkAll('read')"}, 0, false %>
                </div>
                <%= t('article_table.title') %>
              </th>
              <th id="summary-number-top">
                <%= t('article_table.summary')%>
              </th>
            </tr>
            <%= render_read_table = render_article_table('read', @read_articles_table, 'rpage=' + @rpage.to_s) %>
          </table>
        </form>
      </div>
      <% else # @is_login_user || @user.public_flg %>
      <p id="private-message">@<%= @user.name%>'s articles are protected. </p>
      <% end # @is_login_user || @user.public_flg %>
    </div>
  </div>
</div>
